# SPDX-FileCopyrightText: NVIDIA CORPORATION & AFFILIATES
# Copyright (c) 2024 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# System configuration for DeepEP Benchmark tests - GAIA Cluster
name = "gaia-cluster"
scheduler = "slurm"

install_path = "/.autodirect/mtrsysgwork/ybenabou/cloudai/install_dir"
output_path = "/.autodirect/mtrsysgwork/ybenabou/cloudai/results"
default_partition = "GAIA"
cache_docker_images_locally = false

mpi = "pmix"
gpus_per_node = 8
ntasks_per_node = 1

[[partitions]]
name = "GAIA"
nodes = ["dgx-gaia-[09-10,30,36-37,40-42]"]

  [[partitions.groups]]
  name = "low_latency_nodes"
  nodes = ["dgx-gaia-[09-10,30,36-37]"]

  [[partitions.groups]]
  name = "standard_nodes"
  nodes = ["dgx-gaia-[40-41]"]

[global_env_vars]
# NCCL Specific Configurations for DeepEP on GAIA
NCCL_SOCKET_IFNAME = "eno3"
NCCL_IB_HCA = "mlx5_0:1,mlx5_3:1,mlx5_4:1,mlx5_5:1,mlx5_6:1,mlx5_9:1,mlx5_10:1,mlx5_11:1"
NCCL_NET_PLUGIN = "none"
NCCL_IB_GID_INDEX = "auto"
NCCL_IB_QPS_PER_CONNECTION = "4"
NCCL_IB_SPLIT_DATA_ON_QPS = "0"
NCCL_IBEXT_DISABLE = "0"

# GLOO Configuration
GLOO_SOCKET_IFNAME = "eno3"

# OMPI Configuration
OMPI_MCA_btl = "tcp,self"
OMPI_MCA_btl_tcp_if_include = "eno3"

# UCX Configuration
UCX_IB_GID_INDEX = "auto"
UCX_TLS = "rc,cuda_copy"
UCX_RNDV_SCHEME = "get_zcopy"

# Device Visibility Configuration
MELLANOX_VISIBLE_DEVICES = "0,3,4,5,6,9,10,11"
CUDA_VISIBLE_DEVICES = "0,1,2,3,4,5,6,7"

# DeepEP specific environment variables
NUM_QPS_PER_RANK = "12"
NUM_SMS = "24"
LOG_LEVEL = "INFO"

